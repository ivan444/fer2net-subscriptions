<!DOCTYPE html>
<!-- The DOCTYPE declaration above will set the    -->
<!-- browser's rendering engine into               -->
<!-- "Standards Mode". Replacing this declaration  -->
<!-- with a "Quirks Mode" doctype may lead to some -->
<!-- differences in layout.                        -->

<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="{% url templates "f2net-subs.css" %}">
    <link type="text/css" rel="stylesheet" href="{% url templates "demo_page.css" %}">
    <link type="text/css" rel="stylesheet" href="{% url templates "demo_table.css" %}">
    <link type="text/css" rel="stylesheet" href="{% url templates "demo_table_jui.css" %}">
    <title>Fer2Net članarine</title>

    <!--script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script-->
    <script src="{% url js "jquery.js" %}" type="text/javascript"></script>	
    <script src="{% url js "jquery.dataTables.min.js" %}" type="text/javascript"></script>	
    <script type="text/javascript" src="{% url js "f2net-subs.js" %}"></script>

  <script type="text/javascript">

    function confirmPayment(uid) {
      //alert('Done! ' + uid);
      $('#paymentBtn_'+uid).attr("disabled", "true");
      $('#delayBtn_'+uid).attr("disabled", "true");
      $('#deleteBtn_'+uid).removeAttr("disabled");
      $('#expr_days_'+uid).text("365");
    }

    function confirmDeletePayment(uid) {
      //alert('Done! ' + uid);
      $('#paymentBtn_'+uid).removeAttr("disabled");
      $('#delayBtn_'+uid).removeAttr("disabled");
      $('#deleteBtn_'+uid).attr("disabled", "true");
      $('#expr_days_'+uid).text("-");
    }

    function makePayment(uid, amount) {
      $.ajax({
        url: '{% url make_payment %}/'+uid+'/'+amount,
        error: function(jqXHR, textStatus, errorThrown) {
          //alert("Error!\n" + jqXHR + "\n" + textStatus + "\n" + errorThrown); // TODO: humanize error
        },
        success: function(data) {
          confirmPayment(uid);
        }
      });
    }

    function deletePayment(uid) {
      $.ajax({
        url: '{% url delete_payment %}/'+uid,
        error: function(jqXHR, textStatus, errorThrown) {
          //alert("Error!\n" + jqXHR + "\n" + textStatus + "\n" + errorThrown); // TODO: humanize error
        },
        statusCode: {
          404: function() {
            alert('Uplata ne postoji ili nemate dopuštenje za brisanje uplate.');
          }
        },
        success: function(data) {
          confirmDeletePayment(uid);
        }
      });
    }

    function updateAmount() {
      var amount = $("#def_amount_val").val();
      $("[id^=amount_]").each(function (idx) {
          $(this).val(amount);
      });
    }

  </script>
	<!-- End JS -->
    
  </head>

<body>
<script type="text/javascript">
{% block start-scripts %}
  $(document).ready(function() {
    $('#users').dataTable();
    $('#def_amount_val').change(updateAmount);
  });
{% endblock %}
</script>
    
  <!-- web app will not function without JavaScript enabled -->
  <noscript>
    <div style="width: 22em; position: absolute; left: 50%; margin-left: -11em; color: red; background-color: white; border: 1px solid red; padding: 4px; font-family: sans-serif">
      Your web browser must have JavaScript enabled
      in order for this application to display correctly.
    </div>
  </noscript>

  {% if msg_info %}
    <div class="info">{{ msg_info }}</div>
  {% endif %}

  {% if msg_warning %}
    <div class="warning">{{ msg_warning }}</div>
  {% endif %}

  {% if msg_success %}
    <div class="success">{{ msg_success }}</div>
  {% endif %}

  <div id="def_amount">Default amount: <input id="def_amount_val" type="text" size="4" value="30" /></div>
  <table id="users" cellpadding="0" cellspacing="0" border="0" class="display">
    <thead>
      <tr>
        <td>UserID</td>
        <td>Do isteka [dana]</td>
        <td>Username</td>
        <td>Iznos</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
    </thead>
    <tbody>
      {% for u in allUsers %}
        <tr>
          <td>{{ u.userid }}</td>
          <td id="expr_days_{{ u.userid }}">{{ u.sub_expr }}</td>
          <td>{{ u.username }}</td>
          <td><input id="amount_{{ u.userid }}" type="text" size="4" value="30" /></td>
          <td><input id="paymentBtn_{{ u.userid }}"{% if u.valid %} disabled="true"{% endif %} type="button" value="Uplati" onclick="makePayment('{{ u.userid }}', $('#amount_{{ u.userid }}').val())" /></td>
          <td><input id="delayBtn_{{ u.userid }}"{% if u.valid %} disabled="true"{% endif %} type="button" value="Odgoda" onclick="makePayment('{{ u.userid }}', '0')" /></td>
          <td><input id="deleteBtn_{{ u.userid }}"{% if not u.valid %} disabled="true"{% endif %} type="button" value="Obriši" onclick="deletePayment('{{ u.userid }}')" /></td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  <a href="{% url logout %}">Logout</a>

  </body>
</html>

